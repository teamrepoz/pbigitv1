{
  "calculations": [
    {
      "name": "Minor Curve Mapping",
      "table_name": "Risk_GFIRates_Reports_Excel_Rolling (local copy)",
      "tableau_expression": "//For GFI Rates & CMF - Arun 28-April-2017\r\n\r\ncase [Market Title]\r\n\r\n// 1m minors\r\nwhen \"1m AUD Basis\" then \"1m\"\r\nwhen \"1m CAD Basis\" then \"1m\"\r\nwhen \"1m EUR Basis\" then \"1m\"\r\nwhen \"1m GBP Basis\" then \"1m\"\r\nwhen \"1m HKD Basis\" then \"1m\"\r\nwhen \"1m NZD Basis\" then \"1m\"\r\nwhen \"1m USD Basis\" then \"1m\"\r\n\r\n//3m minors\r\nwhen \"3m JPY Basis\" then \"3m\"\r\n\r\n//6m minors\r\nwhen \"6m AUD Basis\" then \"6m\"\r\nwhen \"6m CAD Basis\" then \"6m\"\r\nwhen \"6m CHF Basis\" then \"6m\"\r\nwhen \"6m EUR Basis\" then \"6m\"\r\nwhen \"6m EUR Libor Basis\" then \"6m\"\r\nwhen \"6m GBP Basis\" then \"6m\"\r\nwhen \"6m USD Basis\" then \"6m\"\r\n\r\n//12m minors\r\nwhen \"12m USD Basis\" then \"12m\"\r\n\r\n//Cross Currency Basis\r\nwhen \"CCIRS AUD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CAD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CHF Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CNH Basis\" then \"CCIRS\"\r\nwhen \"CCIRS EUR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS GBP Basis\" then \"CCIRS\"\r\nwhen \"CCIRS HKD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS INR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS JPY Basis\" then \"CCIRS\"\r\nwhen \"CCIRS MYR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS NZD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS SEK Basis\" then \"CCIRS\"\r\n\r\n//OIS Basis\r\nwhen \"OIS AUD Basis\" then \"OIS\"\r\nwhen \"OIS CAD Basis\" then \"OIS\"\r\nwhen \"OIS CHF Basis\" then \"OIS\"\r\nwhen \"OIS EUR Basis\" then \"OIS\"\r\nwhen \"OIS GBP Basis\" then \"OIS\"\r\nwhen \"OIS JPY Basis\" then \"OIS\"\r\nwhen \"OIS USD Basis\" then \"OIS\"\r\n\r\n// CAP Vol\r\nwhen \"USD CAP Vol\" then \"CAP Vol\"\r\nelse [Market Name]\r\nEND",
      "datatype": "string",
      "calculation_context": {
        "Expression": "//For GFI Rates & CMF - Arun 28-April-2017\r\n\r\ncase [Market Title]\r\n\r\n// 1m minors\r\nwhen \"1m AUD Basis\" then \"1m\"\r\nwhen \"1m CAD Basis\" then \"1m\"\r\nwhen \"1m EUR Basis\" then \"1m\"\r\nwhen \"1m GBP Basis\" then \"1m\"\r\nwhen \"1m HKD Basis\" then \"1m\"\r\nwhen \"1m NZD Basis\" then \"1m\"\r\nwhen \"1m USD Basis\" then \"1m\"\r\n\r\n//3m minors\r\nwhen \"3m JPY Basis\" then \"3m\"\r\n\r\n//6m minors\r\nwhen \"6m AUD Basis\" then \"6m\"\r\nwhen \"6m CAD Basis\" then \"6m\"\r\nwhen \"6m CHF Basis\" then \"6m\"\r\nwhen \"6m EUR Basis\" then \"6m\"\r\nwhen \"6m EUR Libor Basis\" then \"6m\"\r\nwhen \"6m GBP Basis\" then \"6m\"\r\nwhen \"6m USD Basis\" then \"6m\"\r\n\r\n//12m minors\r\nwhen \"12m USD Basis\" then \"12m\"\r\n\r\n//Cross Currency Basis\r\nwhen \"CCIRS AUD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CAD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CHF Basis\" then \"CCIRS\"\r\nwhen \"CCIRS CNH Basis\" then \"CCIRS\"\r\nwhen \"CCIRS EUR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS GBP Basis\" then \"CCIRS\"\r\nwhen \"CCIRS HKD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS INR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS JPY Basis\" then \"CCIRS\"\r\nwhen \"CCIRS MYR Basis\" then \"CCIRS\"\r\nwhen \"CCIRS NZD Basis\" then \"CCIRS\"\r\nwhen \"CCIRS SEK Basis\" then \"CCIRS\"\r\n\r\n//OIS Basis\r\nwhen \"OIS AUD Basis\" then \"OIS\"\r\nwhen \"OIS CAD Basis\" then \"OIS\"\r\nwhen \"OIS CHF Basis\" then \"OIS\"\r\nwhen \"OIS EUR Basis\" then \"OIS\"\r\nwhen \"OIS GBP Basis\" then \"OIS\"\r\nwhen \"OIS JPY Basis\" then \"OIS\"\r\nwhen \"OIS USD Basis\" then \"OIS\"\r\n\r\n// CAP Vol\r\nwhen \"USD CAP Vol\" then \"CAP Vol\"\r\nelse [Market Name]\r\nEND",
        "calculated_fields": {
          "Market Name": "[MARKET_NAME]",
          "Market Title": "// Created by Antoine Des Aulniers Favreau\r\n// Updated on 10/13/2017 by Antoine Des Aulniers Favreau\r\n// Current field is not being updated in RWH Market Dim. This is to make sure we do not have null values. This field replace some of the null values in RWH with the logical Market Title RWH for each curve.\r\n// Originally intended for IR curves. Also applied to Inflation curves and Vol. surfaces.\r\n\r\nIF ISNULL([MARKET_TITLE]) THEN\r\n//Major Curve            \r\n    IF CONTAINS([MARKET_NAME],\"Mid\") THEN\r\n        IF LEFT([MARKET_NAME],1)=\"s\" AND LEN([MARKET_NAME])=7 THEN\r\n            CASE REPLACE(REPLACE([MARKET_NAME],\"Mid\",\"\"),\"s\",\"\")\r\n            WHEN \"USO\" THEN \"Major USD\"\r\n            WHEN \"CBO\" THEN \"Major CAD\"\r\n            WHEN \"EBO\" THEN \"Major EUR\"\r\n            WHEN \"GBO\" THEN \"Major GBP\"\r\n            ELSE \"Major \"+REPLACE(REPLACE([MARKET_NAME],\"Mid\",\"\"),\"s\",\"\")\r\n            END\r\n//CCIRS\r\n        ELSEIF CONTAINS([MARKET_NAME],\"USDs\") AND CONTAINS([MARKET_NAME],\"USDMid\") THEN\r\n            \"CCIRS \" + REPLACE(REPLACE([MARKET_NAME],\"USDs\",\"\"),\"USDMid\",\"\") + \" Basis\"\r\n\r\n///Exceptions\r\n        \r\n        //ELSEIF ([Market Name RWH]=\"CHFsCHF6mMid\") THEN \"6m CHF Basis\"\r\n        //ELSEIF ([Market Name RWH]=\"USDsUSD12mMid\") THEN \"12m USD Basis\"\r\n        //ELSEIF ([Market Name RWH]=\"sNZD1mMid\") THEN \"1m NZD Basis\"\r\n        ELSEIF ([MARKET_NAME]=\"USDsUSDCUPOMMid\") THEN \"3m USD CUPOM Basis\"\r\n        ELSEIF ([MARKET_NAME]=\"EURsEURLibor-6mMid\") THEN \"6m EUR Libor Basis\"\r\n\r\n// Vol Surface\r\n        ELSEif LEFT([MARKET_NAME],1)=\"f\" then\r\n            if CONTAINS([MARKET_NAME],\"swpnN\") then mid([MARKET_NAME],2,3) + \" Normal Swaption Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"swpn\") then mid([MARKET_NAME],2,3) + \" Swaption Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"SABRN\") then mid([MARKET_NAME],2,3) + \" Normal SABR Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"SABR\") then mid([MARKET_NAME],2,3) + \" SABR Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"cap\") and CONTAINS([MARKET_NAME],\"1mNMid\")  then mid([MARKET_NAME],2,3) + \" Normal 1M CAP Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"cap\") and CONTAINS([MARKET_NAME],\"NMid\")  then mid([MARKET_NAME],2,3) + \" Normal CAP Vol\"\r\n            elseif CONTAINS([MARKET_NAME],\"cap\") then mid([MARKET_NAME],2,3) + \" CAP Vol\"\r\n            else \"ERR\"\r\n            END\r\n\r\n//Minor 1m,3m,6m,12m   \r\n        ELSEIF CONTAINS([MARKET_NAME],\"1m\") and CONTAINS([MARKET_NAME],\"Mid\")then \"1m \" + left([MARKET_NAME],3)+ \" Basis\"\r\n        ELSEIF CONTAINS([MARKET_NAME],\"3\") and CONTAINS([MARKET_NAME],\"Mid\") then \"3m \" + left([MARKET_NAME],3)+ \" Basis\"\r\n        ELSEIF CONTAINS([MARKET_NAME],\"6\") and CONTAINS([MARKET_NAME],\"Mid\") then \"6m \" + left([MARKET_NAME],3)+ \" Basis\"\r\n        ELSEIF CONTAINS([MARKET_NAME],\"12\") and CONTAINS([MARKET_NAME],\"Mid\") then \"12m \" + left([MARKET_NAME],3)+ \" Basis\"\r\n        ELSE [MARKET_NAME]\r\n\r\n        END\r\n\r\n//Other Vol surface\r\n    ELSEIF CONTAINS([MARKET_NAME],\"skew\") then mid([MARKET_NAME],2,3) + \" Swaption Skew Vol\"\r\n    ELSEIF CONTAINS([MARKET_NAME],\"IR \") THEN REPLACE([MARKET_NAME],\"IR \", \"Major \")\r\n    ELSE [MARKET_NAME]\r\n    END\r\nELSEIF CONTAINS([MARKET_TITLE],\"Eur\") THEN REPLACE([MARKET_TITLE],\"Eur\",\"EUR\")\r\nELSE [MARKET_TITLE]\r\nEND"
        },
        "parameters": [],
        "col_to_datatype_mapping": {
          "MARKET_NAME": "string",
          "MARKET_TITLE": "string"
        },
        "calc_fields_to_datatype_mapping": {
          "Market Name": "String",
          "Market Title": "String"
        }
      }
    }
  ]
}