{
  "fixes": [
    {
      "type": "calculated_column",
      "table": "Risk_GFIRates_Reports_Excel_Rolling (local copy)",
      "name": "marketCCY",
      "dax_expression": "VAR m = 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[Market Name]\nVAR baseNoMidS = LEFT(REPLACE(REPLACE(m, \"Mid\", \"\"), \"s\", \"\"), 3)\nRETURN\nIF(LEFT(m, 3) = \"IR \",\n    REPLACE(m, \"IR \", \"\"),\n    IF(CONTAINSSTRING(m, \"1dMid\"),\n       LEFT(m, SEARCH(\"s\", m, 1, 0) - 1),\n       IF(CONTAINSSTRING(m, \"6mMid\"),\n          LEFT(m, SEARCH(\"s\", m, 1, 0) - 1),\n          IF(CONTAINSSTRING(m, \"12mMid\"),\n             LEFT(m, SEARCH(\"s\", m, 1, 0) - 1),\n             IF(CONTAINSSTRING(m, \"1mMid\"),\n                LEFT(REPLACE(MID(m, SEARCH(\"s\", m, 1, 0) + 1, LEN(m)), \"1mMid\", \"\"), 3),\n                IF(CONTAINSSTRING(m, \"3-monthMid\"),\n                   LEFT(REPLACE(MID(m, SEARCH(\"s\", m, 1, 0) + 1, LEN(m)), \"3-monthMid\", \"\"), 3),\n                   IF(CONTAINSSTRING(m, \"USDMid\") && LEFT(m, 3) = \"USD\",\n                      LEFT(REPLACE(REPLACE(m, \"USDs\", \"\"), \"USDMid\", \"\"), 3),\n                      IF(LEFT(m, 1) = \"s\" && (RIGHT(m, 3) = \"Mid\" || RIGHT(m, 9) = \"Mid_colva\"),\n                         SWITCH(baseNoMidS,\n                                \"USO\", \"USD\",\n                                \"CBO\", \"CAD\",\n                                \"EBO\", \"EUR\",\n                                \"GBO\", \"GBP\",\n                                baseNoMidS),\n                         IF(LEFT(m, 1) = \"p\" && RIGHT(m, 3) = \"Mid\",\n                            REPLACE(REPLACE(m, \"Mid\", \"\"), \"p\", \"\"),\n                            IF((LEFT(m, 1) = \"f\" || LEFT(m, 1) = \"i\") && (RIGHT(m, 3) = \"Mid\" || RIGHT(m, 9) = \"Mid_colva\"),\n                               MID(m, 2, 3),\n                               IF((LEFT(m, 1) = \"f\" && RIGHT(m, 3) = \"Mid\") || CONTAINSSTRING(m, \"Skew\") || CONTAINSSTRING(m, \"SABR\"),\n                                  MID(m, 2, 3),\n                                  IF(RIGHT(m, 4) = \":Std\", LEFT(m, 3),\n                                     IF(m = \"USDsUSDCUPOMMid\", \"USD\",\n                                        IF(CONTAINSSTRING(m, \"xSpot\"), MID(m, 6, 3),\n                                           IF(CONTAINSSTRING(m, \"USCPI\"), \"USD\",\n                                              IF(CONTAINSSTRING(m, \"HICPX\"), \"EUR\",\n                                                 \"ERR\"\n                                              )\n                                           )\n                                        )\n                                     )\n                                  )\n                               )\n                            )\n                         )\n                      )\n                   )\n                )\n             )\n          )\n       )\n    )\n)",
      "solution_explanation": "Converted the row-level Tableau string-parsing logic for marketCCY into a DAX calculated column. Preserved the original branching using IF and nested checks with CONTAINSSTRING, LEFT, RIGHT, MID, SEARCH, REPLACE and returned equivalent string results per the original CASE/IF structure."
    },
    {
      "type": "measure",
      "table": "Risk_GFIRates_Reports_Excel_Rolling (local copy)",
      "name": "Notional Amount FX",
      "dax_expression": "VAR fx = SELECTEDVALUE('FXConversion'[Display As])\nRETURN\nSWITCH(\n    fx,\n    \"Reported\", SUM('Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT]),\n    \"Natural\",\n        SUMX(\n            'Risk_GFIRates_Reports_Excel_Rolling (local copy)',\n            SWITCH(\n                'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[marketCCY],\n                \"AUD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_AUD],\n                \"CAD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_CAD],\n                \"CHF\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_CHF],\n                \"EUR\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_EUR],\n                \"GBP\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_GBP],\n                \"HKD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_HKD],\n                \"JPY\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_JPY],\n                \"MXN\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_MXN],\n                \"NZD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_NZD],\n                \"SEK\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_SEK],\n                \"SGD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_SGD],\n                \"USD\", 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_USD],\n                BLANK()\n            )\n        ),\n    \"CAD\", SUMX('Risk_GFIRates_Reports_Excel_Rolling (local copy)', 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_CAD]),\n    \"USD\", SUMX('Risk_GFIRates_Reports_Excel_Rolling (local copy)', 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_USD]),\n    \"EUR\", SUMX('Risk_GFIRates_Reports_Excel_Rolling (local copy)', 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_EUR]),\n    \"GBP\", SUMX('Risk_GFIRates_Reports_Excel_Rolling (local copy)', 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[NOTIONAL_AMOUNT] * 'Risk_GFIRates_Reports_Excel_Rolling (local copy)'[TO_GBP]),\n    BLANK()\n)",
      "solution_explanation": "Converted the parameter-driven CASE to a DAX measure. The Tableau parameter [Parameters].[FXConversion] is mapped to SELECTEDVALUE('FXConversion'[Display As]). For the \"Reported\" branch the measure sums NOTIONAL_AMOUNT. For the \"Natural\" branch the measure uses SUMX over the table to apply per-row conversion based on the row-level calculated column marketCCY (created earlier) and the appropriate TO_* rate. Explicit SUMX branches are also provided for direct currency selections (CAD, USD, EUR, GBP). BLANK() is used where the original returned null.",
      "type_changed_reason": "The calculation references a Tableau parameter ([Parameters].[FXConversion]); per rules, any parameter-based calculation must be created as a measure."
    }
  ]
}